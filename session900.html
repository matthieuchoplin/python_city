<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>Session 9</title>

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/simple.css" id="theme">
		<!-- Custom css -->
        <link rel="stylesheet" href="css/custom.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/zenburn.css">
		<link rel="stylesheet" href="css/font-awesome.min.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
	</head>
	<body>
	<a href="index.html"><img border="0" alt="Courses" src="imgs/logo.png"></a>
		<div class="reveal">
			<div class="slides">
				<section>
					<h2>Introduction to programming using Python</h2>
					<h3>Session 9</h3>
                    <p>Matthieu Choplin</p>
                    <p><a href='mailto:matthieu.choplin1@city.ac.uk'>matthieu.choplin1@city.ac.uk</a></p>
                    <p><a href='http://moodle.city.ac.uk/'>http://moodle.city.ac.uk/</a></p>
				</section>
				<section>
					<h3>Objectives</h3>
					<ul style="width:100%;font-size: 28px">
						<li>Quick review of what HTML is</li>
                        <li>The find() string method</li>
                        <li>Regular expressions</li>
                        <li>Installing external libraries</li>
                        <li>Using a web parser: BeautifulSoup</li>
                        <li>Emulating a web browser: MechanicalSoup</li>
					</ul>
				</section>

                <section>
                    <h3>The HTML language</h3>
                    <ul>
                        <li>The primary language of information on the internet is the HTML</li>
                        <li>Every webpages are written in HTML</li>
                        <li>To see the source code of the webpage you are currently seeing,
                            do either right click and select "View page Source".
                            Or from the top menu of your browser, click on View and "View Source".</li>
                    </ul>
                </section>

                <section>
                    <h3>Example</h3>
                    <p><a target="_blank" href="http://mattchoplin.com/python_city/practice/Profile_Aphrodite.htm">Profile_Aphrodite.htm</a></p>
                    <div><pre class="solution-content python"><code style="line-height: 100%;font-size: 26px;">&lt;html&gt;&lt;head&gt;&lt;meta http-equiv="Content-Type"
content="text/html; charset=windows-1252"&gt;
&lt;title&gt;Profile: Aphrodite&lt;/title&gt;
&lt;link rel="stylesheet" type="text/css"&gt;&lt;/head&gt;
&lt;body bgcolor="yellow"&gt;
&lt;center&gt;
&lt;br&gt;&lt;br&gt;
&lt;img src="./Profile_ Aphrodite_files/aphrodite.gif"&gt;
&lt;h2&gt;Name: Aphrodite&lt;/h2&gt;
&lt;br&gt;&lt;br&gt;
Favorite animal: Dove
&lt;br&gt;&lt;br&gt;
Favorite color: Red
&lt;br&gt;&lt;br&gt;
Hometown: Mount Olympus
&lt;/center&gt;
&lt;/body&gt;&lt;/html&gt;</code></pre></div>
                </section>

                <section>
                    <h3>Grab all html from a web page</h3>
                    <div><pre class="solution-content python"><code>from urllib.request import urlopen
my_address = "http://mattchoplin.com/python_city/practice/Profile_Aphrodite.htm"
html_page = urlopen(my_address)
html_text = html_page.read().decode('utf-8')
print(html_text)</code></pre></div>
                    <p>What is the type of object that is returned?</p>
                </section>

                <section>
                    <h3>Parsing a web page with a String's method</h3>
                    <ul>
                        <li>You can use the <strong>find()</strong> method</li>
                        <li>Example:</li>
                    </ul>
                    <iframe src="https://trinket.io/embed/python/48fb22f2f5" width="100%" height="300" frameborder="0" marginwidth="0" marginheight="0" allowfullscreen></iframe>
                    <!--
                    <div><pre class="solution-content python"><code>this_is_my_string = 'Programming in python'
string_to_find = input('Enter a string to find in \'%s\': ' % this_is_my_string)
index_found = this_is_my_string.find(string_to_find)
print(index_found)
print(this_is_my_string[index_found])</code></pre></div>
-->
                </section>

                <section>
                    <h3>Find a word between 2 other words</h3>
                    <iframe src="https://trinket.io/embed/python/b7f28ac6c1" width="100%" height="400" frameborder="0" marginwidth="0" marginheight="0" allowfullscreen></iframe>
                    <!--
                    <div><pre class="solution-content python"><code>my_string = 'some text with a special word ' \
            '<strong>Equanimity</strong>'
start_tag = "<strong>"
end_tag = "</strong>"
start_index = my_string.find(start_tag) + len(start_tag)
end_index = my_string.find(end_tag)
# We extract the text between
# the last index of the first tag '>'
# and the first index of the second tag '<'
print(my_string[start_index:end_index])</code></pre></div>
                    -->
                </section>

                <section>
                    <h3>Parsing the title with the find() method</h3>
                    <div><pre class="solution-content python"><code>from urllib.request import urlopen
my_address = "http://mattchoplin.com/python_city/" \
             "practice/Profile_Aphrodite.htm"
html_page = urlopen(my_address)
html_text = html_page.read().decode('utf-8')
start_tag = "&lt;title&gt;"
end_tag = "&lt;/title&gt;"
start_index = html_text.find(start_tag) + len(start_tag)
end_index = html_text.find(end_tag)
print(html_text[start_index:end_index])</code></pre></div>
                </section>

                <section>
                    <h3>Limitation of the find() method</h3>
                    <ul>
                        <li>Try to use the same script for extracting the title of <a target="_blank" href="http://mattchoplin.com/python_city/practice/Profile_Poseidon.htm">Profile_Poseidon.htm</a> </li>
                    </ul>
                    <div><pre class="solution-content python"><code>from urllib.request import urlopen
my_address = "http://mattchoplin.com/python_city/" \
             "practice/Profile_Poseidon.htm"
html_page = urlopen(my_address)
html_text = html_page.read().decode('utf-8')
start_tag = "<title>"
end_tag = "</title>"
start_index = html_text.find(start_tag) + len(start_tag)
end_index = html_text.find(end_tag)
print(html_text[start_index:end_index])</code></pre></div>
                </section>

                <section>
                    <h3>Limitation of the find() method</h3>
                    <ul>
                        <li>Do you see the difference? We are not getting what we want now:</li>
                    </ul>
                    <div><pre class="solution-content python"><code>&lt;head&gt;&lt;meta http-equiv="Content-Type" content="text/html; charset=windows-1252"&gt;
&lt;title &gt;Profile: Poseidon</code></pre></div>
                    <ul>
                        <li>This is because of the extra space before the closing "&gt;" in &lt;title &gt;</li>
                        <li>The html is still rendered by the browser, but we cannot rely on it completely if we want to parse a web page </li>
                    </ul>

                </section>

                <section>
                    <h3>Regular expressions</h3>
                    <ul>
                        <li>They are used to determine whether or not a text matches a particular pattern</li>
                        <li>We can use them thanks to the <strong>re</strong> module in python</li>
                        <li>They use special characters to represent patterns: ^, $, *, +, ., etc...</li>
                    </ul>
                </section>

                <section>
                    <h3>re.findall() using *</h3>
                    <ul>
                        <li>The asterisk character <strong>*</strong> stands for "zero or more" of whatever came just before the asterisk</li>
                        <li><strong>re.findall():</strong></li>
                        <ul>
                            <li>finds any text within a string that matches a given pattern i.e. regex</li>
                            <li>takes 2 arguments, the 1st is the regex, the 2nd is the string to test</li>
                            <li>returns a list of all matches</li>
                        </ul>
                    </ul>
                    <p></p>
                    <div><pre class="solution-content python"><code># re.findall(&lt;regular_expression&gt;, &lt;string_to_test&gt;)</code></pre></div>
                </section>

                <section>
                    <h3>Interactive example</h3>
                    <iframe src="https://trinket.io/embed/python/7c42a37566" width="100%" height="450" frameborder="0" marginwidth="0" marginheight="0" allowfullscreen></iframe>
                </section>

                <section>
                    <h3>re.findall() case insensitive</h3>
                    <ul>
                        <li>Note that re.findall() is case sensitive</li>
                        <div><pre class="solution-content python"><code>re.findall('ab*c', 'ABC') # nothing found</code></pre></div>
                        <li>We can use a 3rd argument <strong>re.IGNORECASE</strong> to ignore the case</li>
                        <div><pre class="solution-content python"><code>re.findall('ab*c', 'ABC', re.IGNORECASE) # ABC found</code></pre></div>
                    </ul>
                </section>

                <section>
                    <h3>re.findall() using . (period)</h3>
                    <ul>
                        <li>the period <strong>.</strong> stands for any single character in a regular expression</li>
                        <li>for instance we could find all the strings that contains the letters "a" and "c" separated by a single character as follows:</li>
                        <iframe src="https://trinket.io/embed/python/396b754ffd" width="100%" height="200" frameborder="0" marginwidth="0" marginheight="0" allowfullscreen></iframe>
                    </ul>
                </section>

                <section>
                    <h3>re.findall() using .* (period asterisk)</h3>
                    <ul>
                        <li>the term <strong>.*</strong> stands for any character being repeated any number of times</li>
                        <li>for instance we could find all the string that starts with "a" and ends with "c", regardless of what is in between with:</li>
                        <iframe src="https://trinket.io/embed/python/1bae467299" width="100%" height="200" frameborder="0" marginwidth="0" marginheight="0" allowfullscreen></iframe>
                    </ul>
                    <!--
import re
print(re.findall('a.*c', 'abc'))
print(re.findall('a.*c', 'abbc'))
print(re.findall('a.*c', 'ac'))
print(re.findall('a.*c', 'acc'))
                    -->
                </section>

                <section>
                    <h3>re.search()</h3>
                    <ul>
                        <li><strong>re.search():</strong></li>
                        <ul>
                            <li>searches for a particular pattern inside a string</li>
                            <li>returns a MatchObject that stores different "groups" of data</li>
                            <li>when we call the group() method on a MatchObject, we get the first and most inclusive result</li>
                        </ul>
                    </ul>
                    <div><pre class="solution-content python"><code>import re
match_results = re.search('ab*c', 'ABC', re.IGNORECASE)
print(match_results.group())  # returns ABC</code></pre></div>
                </section>

                <section>
                    <h3>re.sub()</h3>
                    <ul>
                        <li>re.sub()</li>
                        <ul>
                            <li>allows to replace a text in a string that matches a pattern with a substitute (like the replace() string method)</li>
                            <li>takes 3 arguments:</li>
                            <ol>
                                <li>regex</li>
                                <li>replacement text</li>
                                <li>string to parse</li>
                            </ol>
                        </ul>
                    </ul>
                    <div><pre class="solution-content python"><code>my_string = "This is very boring"
print(my_string.replace('boring', 'funny'))
import re
print(re.sub('boring', 'WHAT?', my_string))</code></pre></div>
                </section>

                <section>
                    <h3>greedy regex (*)</h3>
                    <ul>
                        <li><strong>greedy</strong> expressions try to find the longest possible match when character like <strong>*</strong> are used</li>
                        <li>for instance, in this example the regex finds everything between '&lt;' and  '&gt;' which is actually the whole <em>'&lt;replaced&gt; if it is in &lt;tags&gt'</em></li>
                    </ul>
                    <div><pre class="solution-content python"><code>my_string = 'Everything is &lt;replaced&gt; if it is in &lt;tags&gt;'
my_string = re.sub('<.*>', 'BAR', my_string)
print(my_string)  # 'Everything is BAR'</code></pre></div>
                </section>

                <section>
                    <h3>non-greedy regex (*?)</h3>
                    <ul>
                        <li><strong>*?</strong></li>
                        <ul>
                            <li>works the same as * BUT matches the shortest possible string of text</li>
                        </ul>
                    </ul>
                    <div><pre class="solution-content python"><code>my_string = 'Everything is &lt;replaced&gt; if it is in &lt;tags&gt;'
my_string = re.sub('<.*?>', 'BAR', my_string)
print(my_string)  # 'Everything is BAR if it is in BAR'</code></pre></div>
                </section>

                <section>
                    <h3>Use case: Using regex to parse a webpage</h3>
                    <ul>
                        <li><a target="_blank" href="http://mattchoplin.com/python_city/practice/Profile_Dionysus.htm">Profile_Dionysus.htm</a></li>
                        <li>We want to extract the title:</li>
                        <div><pre class="solution-content python"><code>&lt;TITLE &gt;Profile: Dionysus&lt;/title  / &gt;</code></pre></div>
                        <li>We will use the regular expression for this case</li>
                    </ul>
                </section>

                <section>
                    <h3>Use case: solution</h3>
                    <div><pre class="solution-content python"><code>import re
from urllib.request import urlopen
my_address = "http://mattchoplin.com/python_city/practice/Profile_Dionysus.htm"
html_page = urlopen(my_address)
html_text = html_page.read().decode('utf-8')
match_results = re.search("&lt;title .*?&gt;.*&lt;/title .*?&gt;", html_text, re.IGNORECASE)
title = match_results.group()
title = re.sub("&lt;.*?&gt;", "", title)
print(title)</code></pre></div>
                </section>

                <section>
                    <h3>Use case: explanation</h3>
                    <ul>
                        <li>&lt;title .*?&gt; finds the opening tag where there must be a space after the word "title" and the tag must be closed,
                            but any characters can appear in the rest of the tag.
                            We use the non-greedy <strong>*?</strong>, because we want the first closing "&gt;" to match the tag's end</li>
                        <li><strong>.*</strong> any character can appear in between the &lt;title&gt; tag</li>
                        <li>&lt;\title .*?&gt; same expression as the first part but with the forward slash to represent a closing HTML tag</li>
                        <li>More on regex: <a target="_blank" href="https://docs.python.org/3.5/howto/regex.html">https://docs.python.org/3.5/howto/regex.html</a></li>
                    </ul>
                </section>

                <section>
                    <h3>Installing an external library</h3>
                    <ul>
                        <li>Sometimes what you need is not included in the python standard library and you have to install an external library</li>
                        <li>You are going to use a python package manager: <strong><a href="https://pip.pypa.io/en/latest/installing/">pip</a></strong></li>
                        <li>The packages (libraries) that you can install with pip are listed on <a href="https://pypi.python.org/pypi">https://pypi.python.org/pypi</a></li>
                        <li>If you do not have pip, you can use the command "python setup.py install" from the package you would have downloaded and uncompressed from <a href="https://pypi.python.org/pypi">pypi</a></li>
                    </ul>
                </section>

                <section>
                    <h3>Installing with Pycharm (1)</h3>
                    <img src="imgs/pycharm_install_package1.PNG" style="background:none; border:none; box-shadow:none; margin-top:0px;height: 450px"/>
                </section>

                <section>
                    <h3>Installing with Pycharm (2)</h3>
                    <img src="imgs/pycharm_install_package2.PNG" style="background:none; border:none; box-shadow:none; margin-top:0px;height: 450px"/>
                </section>

                <section>
                    <h3>Installing with Pycharm (3)</h3>
                    <img src="imgs/pycharm_install_package3.PNG" style="background:none; border:none; box-shadow:none; margin-top:0px;height: 450px"/>
                </section>

                <section>
                    <h3>Using Beautiful Soup</h3>
                    <div><pre class="solution-content python"><code>from bs4 import BeautifulSoup
from urllib.request import urlopen
my_address = "http://mattchoplin.com/python_city/" \
             "practice/Profile_Dionysus.htm"
html_page = urlopen(my_address)
html_text = html_page.read().decode('utf-8')
my_soup = BeautifulSoup(html_text, "html.parser")</code></pre></div>
                </section>

                <section>
                    <h3>BeautifulSoup: get_text()</h3>
                    <ul>
                        <li><strong>get_text()</strong></li>
                        <ul>
                            <li>is extracting only the text from an html document</li>
                            <div><pre class="solution-content python"><code>print(my_soup.get_text())</code></pre></div>
                        </ul>
                        <li>there are lot of blank lines left but we can remove them with the method <strong>replace()</strong></li>
                        <div><pre class="solution-content python"><code>print(my_soup.get_text().replace("\n\n\n",""))</code></pre></div>
                        <li>Using BeautifulSoup to extract the text first and use the find() method is <em>sometimes</em> easier than to use regular expressions</li>
                    </ul>
                </section>

                <section>
                    <h3>BeautifulSoup: find_all()</h3>
                    <ul>
                        <li>find_all()</li>
                        <ul>
                            <li>returns a list of all elements of a particular tag given in argument</li>
                        </ul>
                    <div><pre class="solution-content python"><code>print(my_soup.find_all("img"))</code></pre></div>
                        <li>What if the HTML page is broken?</li>
                    </ul>
                </section>

                <section>
                    <h3>BeautifulSoup: Tags</h3>
                                        <div><pre class="solution-content python"><code style="line-height: 100%">[&lt;img src="dionysus.jpg"/&gt;, &lt;img src="grapes.png"&gt;&lt;br&gt;&lt;br&gt;
Hometown: Mount Olympus
&lt;br&gt;&lt;br&gt;
Favorite animal: Leopard &lt;br&gt;
&lt;br&gt;
Favorite Color: Wine
&lt;/br&gt;&lt;/br&gt;&lt;/br&gt;&lt;/br&gt;&lt;/br&gt;&lt;/br&gt;&lt;/img&gt;]</code></pre></div>
                    <ul>
                        <li>This is not what we were looking for. The &lt;img&gt; is not properly closed therefore BeautifulSoup ends up adding a fair
                            amount of HTML after the image tag before inserting a &lt;/img&gt; tag on its own. This can happen with real case.</li>
                        <li>NB: BeautifulSoup is storing HTML tags as <em>Tag</em> objects and we can extract information from each Tag.</li>
                    </ul>
                </section>

                <section>
                    <h3>BeautifulSoup: Extracting information from Tags</h3>
                    <ul>
                        <li><strong>Tags</strong>:</li>
                        <ul>
                            <li>have a name</li>
                            <li>have attributes, accessible using keys, like when we access values of a dictionary through its keys</li>
                        </ul>
                    </ul>
                        <div><pre class="solution-content python"><code>for tag in my_soup.find_all("img"):
    print(tag.name)
    print(tag['src'])</code></pre></div>
                </section>

                <section>
                    <h3>BeautifulSoup: accessing a Tag through its name</h3>
                    <ul>
                        <div><pre class="solution-content python"><code>print(my_soup.title)</code></pre></div>
                        <li>The HTML is cleaned up</li>
                        <li>We can use the string attributes stored by the title</li>
                        <div><pre class="solution-content python"><code>print(my_soup.title.string)</code></pre></div>
                    </ul>

                </section>

                <section>
                    <h3>Emulating a web browser</h3>
                    <ul>
                        <li>Sometimes we need to submit information to a web page, like a login page</li>
                        <li>We need a web browser for that</li>
                        <li><strong><a href="https://github.com/hickford/MechanicalSoup">MechanicalSoup</a></strong> is an alternative to urllib that can do all the same things but has more added
                            functionality that will allow us to talk back to webpages without using a standalone browser,
                            perfect for fetching web pages, clicking on buttons and links, and filling out and submitting forms</li>
                    </ul>

                </section>

                <section>
                    <h3>Installing MechanicalSoup</h3>
                    <ul>
                        <li>You can install it with pip: <em>pip install MechanicalSoup</em> or within Pycharm (like what we did earlier with BeautifulSoup)</li>
                        <li>You might need to restart your IDE for MechanicalSoup to load and be recognised</li>
                    </ul>

                </section>

                <section>
                    <h3>MechanicalSoup: Opening a web page</h3>
                    <ul>
                        <li>Create a browser</li>
                        <li>Get a web page which is a Response object</li>
                        <li>Access the HTML content with the <em>soup</em> attribute</li>
                        <div><pre class="solution-content python"><code>import mechanicalsoup

my_browser = mechanicalsoup.Browser(soup_config={'features':'html.parser'})
page = my_browser.get("http://mattchoplin.com/python_city/practice/Profile_Aphrodite.htm")
print(page.soup)</code></pre></div>

                    </ul>

                </section>

                <section>
                    <h3>MechanicalSoup: Submitting values to a form</h3>
                    <ul>
                        <li>Have a look at this <a href="http://mattchoplin.com/python_city/practice/LogIn.htm">login page</a></li>
                        <li>The important section is the login form</li>
                        <li>We can see that there is a submission &lt;form&gt; named "login" that includes two &lt;input&gt; tags, one named
                            <em>id</em> and the other one named <em>pass</em>.</li>
                        <li>The third &lt;input&gt; is the actual "Submit" button</li>
                    </ul>

                </section>

                <section>
                    <h3></h3>
                    <ul>
                        <li></li>
                    </ul>

                </section>

			</div>
		</div>
		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>
			// More info https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				history: true,
				slideNumber: true,
				center: false,

				// More info https://github.com/hakimel/reveal.js#dependencies
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/menu/menu.js' },
					{ src: 'plugin/jquery-2.0.0.min.js' },
					{ src: 'plugin/custom.js' },
					{ src: 'plugin/clipboard.min.js' },

				]
			});
		</script>
	</body>
</html>
